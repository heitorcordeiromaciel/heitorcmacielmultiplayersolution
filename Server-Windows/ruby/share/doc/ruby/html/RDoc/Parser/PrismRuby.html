<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>class RDoc::Parser::PrismRuby - Documentation for Ruby 3.4</title>

  <meta name="keywords" content="ruby,class,RDoc::Parser::PrismRuby">

    <meta name="description" content="class RDoc::Parser::PrismRuby: Parse and collect document from Ruby source code. Ruby and aims to replace it.">


<link rel="canonical" href="https://docs.ruby-lang.org/en/3.4/RDoc/Parser/PrismRuby.html">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  <div id="parent-class-section" class="nav-section">
  <h3>Ancestors</h3>
  <ul><li><a href="../Parser.html">RDoc::Parser</a><ul><li><a href="../../Object.html">Object</a><ul><li><a href="../../BasicObject.html">BasicObject</a></li></ul></li></ul></li></ul>
</div>

  
  
  
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li class="calls-super" ><a href="#method-c-new">new</a></li>
    </ul>
  </div>



  <div class="nav-section">
    <h3>Instance Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-i-add_alias_method">add_alias_method</a></li>
      <li ><a href="#method-i-add_attributes">add_attributes</a></li>
      <li ><a href="#method-i-add_constant">add_constant</a></li>
      <li ><a href="#method-i-add_method">add_method</a></li>
      <li ><a href="#method-i-add_module_or_class">add_module_or_class</a></li>
      <li ><a href="#method-i-change_method_to_module_function">change_method_to_module_function</a></li>
      <li ><a href="#method-i-change_method_visibility">change_method_visibility</a></li>
      <li ><a href="#method-i-consecutive_comment">consecutive_comment</a></li>
      <li ><a href="#method-i-find_or_create_constant_owner_name">find_or_create_constant_owner_name</a></li>
      <li ><a href="#method-i-find_or_create_module_path">find_or_create_module_path</a></li>
      <li ><a href="#method-i-handle_meta_method_comment">handle_meta_method_comment</a></li>
      <li ><a href="#method-i-parse_comment_tomdoc">parse_comment_tomdoc</a></li>
      <li ><a href="#method-i-prepare_comments">prepare_comments</a></li>
      <li ><a href="#method-i-process_comments_until">process_comments_until</a></li>
      <li ><a href="#method-i-resolve_constant_path">resolve_constant_path</a></li>
      <li ><a href="#method-i-scan">scan</a></li>
      <li ><a href="#method-i-skip_comments_until">skip_comments_until</a></li>
      <li ><a href="#method-i-visible_tokens_from_location">visible_tokens_from_location</a></li>
      <li ><a href="#method-i-with_container">with_container</a></li>
      <li ><a href="#method-i-with_in_proc_block">with_in_proc_block</a></li>
    </ul>
  </div>



  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.14.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="class-RDoc::Parser::PrismRuby">
  
  
    <ol role="navigation" aria-label="breadcrumb" class="breadcrumb">
      
      <li>
        
        <a href="../../RDoc.html">RDoc</a><span>::</span>
        
      </li>
      
      <li>
        
        <a href="../../RDoc/Parser.html">Parser</a><span>::</span>
        
      </li>
      
      <li>
        
        <span>PrismRuby</span>
        
      </li>
      
    </ol>
  

  <h1 id="class-RDoc::Parser::PrismRuby" class="anchor-link class">
    class RDoc::Parser::PrismRuby
  </h1>

  <section class="description">
    
<p>Parse and collect document from Ruby source code. <a href="PrismRuby.html"><code>RDoc::Parser::PrismRuby</code></a> is compatible with <a href="Ruby.html"><code>RDoc::Parser::Ruby</code></a> and aims to replace it.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-container" class="method-detail anchor-link">
        <div class="method-heading attribute-method-heading">
          <a href="#attribute-i-container" title="Link to this attribute">
            <span class="method-name">container</span>
            <span class="attribute-access-type">[R]</span>
          </a>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-singleton" class="method-detail anchor-link">
        <div class="method-heading attribute-method-heading">
          <a href="#attribute-i-singleton" title="Link to this attribute">
            <span class="method-name">singleton</span>
            <span class="attribute-access-type">[R]</span>
          </a>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-visibility" class="method-detail anchor-link">
        <div class="method-heading attribute-method-heading">
          <a href="#attribute-i-visibility" title="Link to this attribute">
            <span class="method-name">visibility</span>
            <span class="attribute-access-type">[RW]</span>
          </a>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-new" title="Link to this method">
                <span class="method-name">new</span>
                <span class="method-args">(top_level, content, options, stats)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">top_level</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">stats</span>)
  <span class="ruby-keyword">super</span>

  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">handle_tab_width</span>(<span class="ruby-identifier">content</span>)

  <span class="ruby-ivar">@size</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@token_listeners</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">content</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">remove_magic_comment</span> <span class="ruby-identifier">content</span>
  <span class="ruby-ivar">@content</span> = <span class="ruby-identifier">content</span>
  <span class="ruby-ivar">@markup</span> = <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">markup</span>
  <span class="ruby-ivar">@track_visibility</span> = <span class="ruby-value">:nodoc</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">visibility</span>
  <span class="ruby-ivar">@encoding</span> = <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">encoding</span>

  <span class="ruby-ivar">@module_nesting</span> = [[<span class="ruby-identifier">top_level</span>, <span class="ruby-keyword">false</span>]]
  <span class="ruby-ivar">@container</span> = <span class="ruby-identifier">top_level</span>
  <span class="ruby-ivar">@visibility</span> = <span class="ruby-value">:public</span>
  <span class="ruby-ivar">@singleton</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@in_proc_block</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="../Parser.html#method-c-new"><code>RDoc::Parser::new</code></a>
            </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-add_alias_method" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-add_alias_method" title="Link to this method">
                <span class="method-name">add_alias_method</span>
                <span class="method-args">(old_name, new_name, line_no)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="add_alias_method-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 448</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_alias_method</span>(<span class="ruby-identifier">old_name</span>, <span class="ruby-identifier">new_name</span>, <span class="ruby-identifier">line_no</span>)
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">consecutive_comment</span>(<span class="ruby-identifier">line_no</span>)
  <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
  <span class="ruby-identifier">visibility</span> = <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">find_method</span>(<span class="ruby-identifier">old_name</span>, <span class="ruby-ivar">@singleton</span>)&amp;.<span class="ruby-identifier">visibility</span> <span class="ruby-operator">||</span> <span class="ruby-value">:public</span>
  <span class="ruby-identifier">a</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Alias</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">old_name</span>, <span class="ruby-identifier">new_name</span>, <span class="ruby-identifier">comment</span>, <span class="ruby-value">singleton:</span> <span class="ruby-ivar">@singleton</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">line_no</span>)
  <span class="ruby-identifier">a</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
  <span class="ruby-identifier">a</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line_no</span>
  <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">a</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_document?</span>(<span class="ruby-identifier">a</span>)
    <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_alias</span>(<span class="ruby-identifier">a</span>)
    <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">find_method</span>(<span class="ruby-identifier">new_name</span>, <span class="ruby-ivar">@singleton</span>)&amp;.<span class="ruby-identifier">visibility</span> = <span class="ruby-identifier">visibility</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Handles ‘alias foo bar` and `alias_method :foo, :bar`</p>
        </div>


      </div>

      <div id="method-i-add_attributes" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-add_attributes" title="Link to this method">
                <span class="method-name">add_attributes</span>
                <span class="method-args">(names, rw, line_no)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="add_attributes-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 465</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_attributes</span>(<span class="ruby-identifier">names</span>, <span class="ruby-identifier">rw</span>, <span class="ruby-identifier">line_no</span>)
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">consecutive_comment</span>(<span class="ruby-identifier">line_no</span>)
  <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">document_children</span>

  <span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">symbol</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">a</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Attr</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">symbol</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">rw</span>, <span class="ruby-identifier">comment</span>, <span class="ruby-value">singleton:</span> <span class="ruby-ivar">@singleton</span>)
    <span class="ruby-identifier">a</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
    <span class="ruby-identifier">a</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line_no</span>
    <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">a</span>)
    <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">line_no</span>)
    <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">a</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_document?</span>(<span class="ruby-identifier">a</span>)
    <span class="ruby-identifier">a</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-identifier">visibility</span> <span class="ruby-comment"># should set after adding to container</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Handles ‘attr :a, :b`, `attr_reader :a, :b`, `attr_writer :a, :b` and `attr_accessor :a, :b`</p>
        </div>


      </div>

      <div id="method-i-add_constant" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-add_constant" title="Link to this method">
                <span class="method-name">add_constant</span>
                <span class="method-args">(constant_name, rhs_name, start_line, end_line)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="add_constant-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 635</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_constant</span>(<span class="ruby-identifier">constant_name</span>, <span class="ruby-identifier">rhs_name</span>, <span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">end_line</span>)
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">consecutive_comment</span>(<span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
  <span class="ruby-identifier">owner</span>, <span class="ruby-identifier">name</span> = <span class="ruby-identifier">find_or_create_constant_owner_name</span>(<span class="ruby-identifier">constant_name</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">owner</span>

  <span class="ruby-identifier">constant</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Constant</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">rhs_name</span>, <span class="ruby-identifier">comment</span>)
  <span class="ruby-identifier">constant</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
  <span class="ruby-identifier">constant</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">start_line</span>
  <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">constant</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">constant</span>, <span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">constant</span>, <span class="ruby-identifier">end_line</span>)
  <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">add_constant</span>(<span class="ruby-identifier">constant</span>)
  <span class="ruby-identifier">mod</span> =
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rhs_name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^::/</span>
      <span class="ruby-ivar">@store</span>.<span class="ruby-identifier">find_class_or_module</span>(<span class="ruby-identifier">rhs_name</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">rhs_name</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">constant</span>.<span class="ruby-identifier">document_self</span>
    <span class="ruby-identifier">a</span> = <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_module_alias</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">rhs_name</span>, <span class="ruby-identifier">constant</span>, <span class="ruby-ivar">@top_level</span>)
    <span class="ruby-identifier">a</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
    <span class="ruby-identifier">a</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">start_line</span>
    <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">a</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Adds a constant</p>
        </div>


      </div>

      <div id="method-i-add_method" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-add_method" title="Link to this method">
                <span class="method-name">add_method</span>
                <span class="method-args">(name, receiver_name:, receiver_fallback_type:, visibility:, singleton:, params:, calls_super:, block_params:, tokens:, start_line:, args_end_line:, end_line:)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="add_method-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_method</span>(<span class="ruby-identifier">name</span>, <span class="ruby-value">receiver_name:</span>, <span class="ruby-value">receiver_fallback_type:</span>, <span class="ruby-value">visibility:</span>, <span class="ruby-value">singleton:</span>, <span class="ruby-value">params:</span>, <span class="ruby-value">calls_super:</span>, <span class="ruby-value">block_params:</span>, <span class="ruby-value">tokens:</span>, <span class="ruby-value">start_line:</span>, <span class="ruby-value">args_end_line:</span>, <span class="ruby-value">end_line:</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@in_proc_block</span>

  <span class="ruby-identifier">receiver</span> = <span class="ruby-identifier">receiver_name</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">find_or_create_module_path</span>(<span class="ruby-identifier">receiver_name</span>, <span class="ruby-identifier">receiver_fallback_type</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@container</span>
  <span class="ruby-identifier">meth</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">name</span>, <span class="ruby-value">singleton:</span> <span class="ruby-identifier">singleton</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">consecutive_comment</span>(<span class="ruby-identifier">start_line</span>))
    <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
    <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">comment</span>)

    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">normalize</span>
    <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">call_seq</span> = <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">extract_call_seq</span>
    <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comment</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">args_end_line</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">end_line</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">should_document?</span>(<span class="ruby-identifier">meth</span>)

  <span class="ruby-identifier">internal_add_method</span>(
    <span class="ruby-identifier">receiver</span>,
    <span class="ruby-identifier">meth</span>,
    <span class="ruby-value">line_no:</span> <span class="ruby-identifier">start_line</span>,
    <span class="ruby-value">visibility:</span> <span class="ruby-identifier">visibility</span>,
    <span class="ruby-value">params:</span> <span class="ruby-identifier">params</span>,
    <span class="ruby-value">calls_super:</span> <span class="ruby-identifier">calls_super</span>,
    <span class="ruby-value">block_params:</span> <span class="ruby-identifier">block_params</span>,
    <span class="ruby-value">tokens:</span> <span class="ruby-identifier">tokens</span>
  )

  <span class="ruby-comment"># Rename after add_method to register duplicated &#39;new&#39; and &#39;initialize&#39;</span>
  <span class="ruby-comment"># defined in c and ruby just like the old parser did.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;initialize&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">singleton</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">dont_rename_initialize</span>
      <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-value">:protected</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;new&#39;</span>
      <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-value">:public</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Adds a method defined by ‘def` syntax</p>
        </div>


      </div>

      <div id="method-i-add_module_or_class" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-add_module_or_class" title="Link to this method">
                <span class="method-name">add_module_or_class</span>
                <span class="method-args">(module_name, start_line, end_line, is_class: false, superclass_name: nil, superclass_expr: nil)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="add_module_or_class-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 664</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_module_or_class</span>(<span class="ruby-identifier">module_name</span>, <span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">end_line</span>, <span class="ruby-value">is_class:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">superclass_name:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">superclass_expr:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">consecutive_comment</span>(<span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">document_children</span>

  <span class="ruby-identifier">owner</span>, <span class="ruby-identifier">name</span> = <span class="ruby-identifier">find_or_create_constant_owner_name</span>(<span class="ruby-identifier">module_name</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">owner</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_class</span>
    <span class="ruby-comment"># RDoc::NormalClass resolves superclass name despite of the lack of module nesting information.</span>
    <span class="ruby-comment"># We need to fix it when RDoc::NormalClass resolved to a wrong constant name</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass_name</span>
      <span class="ruby-identifier">superclass_full_path</span> = <span class="ruby-identifier">resolve_constant_path</span>(<span class="ruby-identifier">superclass_name</span>)
      <span class="ruby-identifier">superclass</span> = <span class="ruby-ivar">@store</span>.<span class="ruby-identifier">find_class_or_module</span>(<span class="ruby-identifier">superclass_full_path</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass_full_path</span>
      <span class="ruby-identifier">superclass_full_path</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">superclass_name</span>
      <span class="ruby-identifier">superclass_full_path</span> = <span class="ruby-identifier">superclass_full_path</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^::/</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># add_class should be done after resolving superclass</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">classes_hash</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">add_class</span>(<span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">NormalClass</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">superclass_name</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">superclass_expr</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;::Object&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass_name</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass</span>
        <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">superclass</span> = <span class="ruby-identifier">superclass</span>
      <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">mod</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Object&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">superclass</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">superclass_full_path</span>
        <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">superclass</span> = <span class="ruby-identifier">superclass_full_path</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">modules_hash</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">owner</span>.<span class="ruby-identifier">add_module</span>(<span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">NormalModule</span>, <span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
  <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">start_line</span>
  <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">mod</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">handle_modifier_directive</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">end_line</span>)
  <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">add_comment</span>(<span class="ruby-identifier">comment</span>, <span class="ruby-ivar">@top_level</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>
  <span class="ruby-identifier">mod</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Adds module or class</p>
        </div>


      </div>

      <div id="method-i-change_method_to_module_function" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-change_method_to_module_function" title="Link to this method">
                <span class="method-name">change_method_to_module_function</span>
                <span class="method-args">(names)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="change_method_to_module_function-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">change_method_to_module_function</span>(<span class="ruby-identifier">names</span>)
  <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">set_visibility_for</span>(<span class="ruby-identifier">names</span>, <span class="ruby-value">:private</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">new_methods</span> = []
  <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">methods_matching</span>(<span class="ruby-identifier">names</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s_m</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">s_m</span>)
    <span class="ruby-identifier">s_m</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">new_methods</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s_m</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">new_methods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">method</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">AnyMethod</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Attr</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">method</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-value">:public</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Handles ‘module_function :foo, :bar`</p>
        </div>


      </div>

      <div id="method-i-change_method_visibility" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-change_method_visibility" title="Link to this method">
                <span class="method-name">change_method_visibility</span>
                <span class="method-args">(names, visibility, singleton: @singleton)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="change_method_visibility-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">change_method_visibility</span>(<span class="ruby-identifier">names</span>, <span class="ruby-identifier">visibility</span>, <span class="ruby-value">singleton:</span> <span class="ruby-ivar">@singleton</span>)
  <span class="ruby-identifier">new_methods</span> = []
  <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">methods_matching</span>(<span class="ruby-identifier">names</span>, <span class="ruby-identifier">singleton</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@container</span>
      <span class="ruby-identifier">m</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">m</span>)
      <span class="ruby-identifier">new_methods</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">m</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-identifier">visibility</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">new_methods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">method</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">AnyMethod</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Attr</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">method</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-identifier">visibility</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Handles ‘public :foo, :bar` `private :foo, :bar` and `protected :foo, :bar`</p>
        </div>


      </div>

      <div id="method-i-consecutive_comment" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-consecutive_comment" title="Link to this method">
                <span class="method-name">consecutive_comment</span>
                <span class="method-args">(line_no)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="consecutive_comment-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">consecutive_comment</span>(<span class="ruby-identifier">line_no</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">first</span>&amp;.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">line_no</span>
    <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Returns consecutive comment linked to the given line number</p>
        </div>


      </div>

      <div id="method-i-find_or_create_constant_owner_name" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-find_or_create_constant_owner_name" title="Link to this method">
                <span class="method-name">find_or_create_constant_owner_name</span>
                <span class="method-args">(constant_path)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="find_or_create_constant_owner_name-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 619</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_or_create_constant_owner_name</span>(<span class="ruby-identifier">constant_path</span>)
  <span class="ruby-identifier">const_path</span>, <span class="ruby-identifier">colon</span>, <span class="ruby-identifier">name</span> = <span class="ruby-identifier">constant_path</span>.<span class="ruby-identifier">rpartition</span>(<span class="ruby-string">&#39;::&#39;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">colon</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment"># class Foo</span>
    <span class="ruby-comment"># Within `class C` or `module C`, owner is C(== current container)</span>
    <span class="ruby-comment"># Within `class &lt;&lt;C`, owner is C.singleton_class</span>
    <span class="ruby-comment"># but RDoc don&#39;t track constants of a singleton class of module</span>
    [(<span class="ruby-ivar">@singleton</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@container</span>), <span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">const_path</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment"># class ::Foo</span>
    [<span class="ruby-ivar">@top_level</span>, <span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">else</span> <span class="ruby-comment"># `class Foo::Bar` or `class ::Foo::Bar`</span>
    [<span class="ruby-identifier">find_or_create_module_path</span>(<span class="ruby-identifier">const_path</span>, <span class="ruby-value">:module</span>), <span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Returns a pair of owner module and constant name from a given constant path. Creates owner module if it does not exist.</p>
        </div>


      </div>

      <div id="method-i-find_or_create_module_path" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-find_or_create_module_path" title="Link to this method">
                <span class="method-name">find_or_create_module_path</span>
                <span class="method-args">(module_name, create_mode)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="find_or_create_module_path-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 570</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_or_create_module_path</span>(<span class="ruby-identifier">module_name</span>, <span class="ruby-identifier">create_mode</span>)
  <span class="ruby-identifier">root_name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">name</span> = <span class="ruby-identifier">module_name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;::&#39;</span>)
  <span class="ruby-identifier">add_module</span> = <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">mode</span>) {
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">mode</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:class</span>
      <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">add_class</span>(<span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">NormalClass</span>, <span class="ruby-identifier">name</span>, <span class="ruby-string">&#39;Object&#39;</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:module</span>
      <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">add_module</span>(<span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">NormalModule</span>, <span class="ruby-identifier">name</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span> }
    <span class="ruby-keyword">end</span>
  }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">root_name</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-ivar">@top_level</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@module_nesting</span>.<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">nesting</span>, <span class="ruby-identifier">singleton</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">singleton</span>
      <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">nesting</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">root_name</span>)
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span>
      <span class="ruby-comment"># If a constant is found and it is not a module or class, RDoc can&#39;t document about it.</span>
      <span class="ruby-comment"># Return an anonymous module to avoid wrong document creation.</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">NormalModule</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">nesting</span>.<span class="ruby-identifier">find_constant_named</span>(<span class="ruby-identifier">root_name</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">last_nesting</span>, = <span class="ruby-ivar">@module_nesting</span>.<span class="ruby-identifier">reverse_each</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">singleton</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">singleton</span> }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">mod</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">add_module</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">last_nesting</span>, <span class="ruby-identifier">root_name</span>, <span class="ruby-identifier">create_mode</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">mod</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">add_module</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">last_nesting</span>, <span class="ruby-identifier">root_name</span>, <span class="ruby-value">:module</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">path</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">add_module</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">name</span>, <span class="ruby-value">:module</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">add_module</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">create_mode</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p><a href="../../Find.html"><code>Find</code></a> or create module or class from a given module name. If module or class does not exist, creates a module or a class according to ‘create_mode` argument.</p>
        </div>


      </div>

      <div id="method-i-handle_meta_method_comment" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-handle_meta_method_comment" title="Link to this method">
                <span class="method-name">handle_meta_method_comment</span>
                <span class="method-args">(comment, node)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="handle_meta_method_comment-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">handle_meta_method_comment</span>(<span class="ruby-identifier">comment</span>, <span class="ruby-identifier">node</span>)
  <span class="ruby-identifier">is_call_node</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Prism</span><span class="ruby-operator">::</span><span class="ruby-constant">CallNode</span>)
  <span class="ruby-identifier">singleton_method</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">visibility</span> = <span class="ruby-ivar">@visibility</span>
  <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">rw</span> = <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">method_name</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">processed_comment</span> = <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-ivar">@preprocess</span>.<span class="ruby-identifier">handle</span>(<span class="ruby-identifier">processed_comment</span>, <span class="ruby-ivar">@container</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span>, <span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">directive</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;attr&#39;</span>, <span class="ruby-string">&#39;attr_reader&#39;</span>, <span class="ruby-string">&#39;attr_writer&#39;</span>, <span class="ruby-string">&#39;attr_accessor&#39;</span>
      <span class="ruby-identifier">attributes</span> = [<span class="ruby-identifier">param</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">param</span>
      <span class="ruby-identifier">attributes</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">call_node_name_arguments</span>(<span class="ruby-identifier">node</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_call_node</span>
      <span class="ruby-identifier">rw</span> = <span class="ruby-identifier">directive</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;attr_writer&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;W&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">directive</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;attr_accessor&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;RW&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;R&#39;</span>
      <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;method&#39;</span>
      <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">param</span>
      <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">line</span>
      <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;singleton-method&#39;</span>
      <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">param</span>
      <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">line</span>
      <span class="ruby-identifier">singleton_method</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">visibility</span> = <span class="ruby-value">:public</span>
      <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;section&#39;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">set_current_section</span>(<span class="ruby-identifier">param</span>, <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">dup</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-comment"># If the comment contains :section:, it is not a meta method comment</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attributes</span>
    <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">a</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Attr</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">attr</span>, <span class="ruby-identifier">rw</span>, <span class="ruby-identifier">processed_comment</span>, <span class="ruby-value">singleton:</span> <span class="ruby-ivar">@singleton</span>)
      <span class="ruby-identifier">a</span>.<span class="ruby-identifier">store</span> = <span class="ruby-ivar">@store</span>
      <span class="ruby-identifier">a</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line_no</span>
      <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">a</span>)
      <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">a</span>)
      <span class="ruby-identifier">a</span>.<span class="ruby-identifier">visibility</span> = <span class="ruby-identifier">visibility</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line_no</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">node</span>
    <span class="ruby-identifier">method_name</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">call_node_name_arguments</span>(<span class="ruby-identifier">node</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_call_node</span>
    <span class="ruby-identifier">meth</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-value">singleton:</span> <span class="ruby-ivar">@singleton</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">singleton_method</span>)
    <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">comment</span>)
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">normalize</span>
    <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">call_seq</span> = <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">extract_call_seq</span>
    <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comment</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>
      <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">visible_tokens_from_location</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">location</span>)
      <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">tokens</span> = [<span class="ruby-identifier">file_line_comment_token</span>(<span class="ruby-identifier">line_no</span>)]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">internal_add_method</span>(
      <span class="ruby-ivar">@container</span>,
      <span class="ruby-identifier">meth</span>,
      <span class="ruby-value">line_no:</span> <span class="ruby-identifier">line_no</span>,
      <span class="ruby-value">visibility:</span> <span class="ruby-identifier">visibility</span>,
      <span class="ruby-value">params:</span> <span class="ruby-string">&#39;()&#39;</span>,
      <span class="ruby-value">calls_super:</span> <span class="ruby-keyword">false</span>,
      <span class="ruby-value">block_params:</span> <span class="ruby-keyword">nil</span>,
      <span class="ruby-value">tokens:</span> <span class="ruby-identifier">tokens</span>
    )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Handles meta method comments</p>
        </div>


      </div>

      <div id="method-i-parse_comment_tomdoc" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-parse_comment_tomdoc" title="Link to this method">
                <span class="method-name">parse_comment_tomdoc</span>
                <span class="method-args">(container, comment, line_no, start_line)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="parse_comment_tomdoc-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_comment_tomdoc</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">comment</span>, <span class="ruby-identifier">line_no</span>, <span class="ruby-identifier">start_line</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">signature</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">TomDoc</span>.<span class="ruby-identifier">signature</span>(<span class="ruby-identifier">comment</span>)

  <span class="ruby-identifier">name</span>, = <span class="ruby-identifier">signature</span>.<span class="ruby-identifier">split</span> <span class="ruby-regexp">%r%[ \(]%</span>, <span class="ruby-value">2</span>

  <span class="ruby-identifier">meth</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">GhostMethod</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">text</span>, <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">record_location</span>(<span class="ruby-identifier">meth</span>)
  <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">start_line</span>
  <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">call_seq</span> = <span class="ruby-identifier">signature</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">name</span>

  <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">start_collecting_tokens</span>
  <span class="ruby-identifier">node</span> = <span class="ruby-ivar">@line_nodes</span>[<span class="ruby-identifier">line_no</span>]
  <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">node</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">visible_tokens_from_location</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">location</span>) <span class="ruby-operator">:</span> [<span class="ruby-identifier">file_line_comment_token</span>(<span class="ruby-identifier">start_line</span>)]
  <span class="ruby-identifier">tokens</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">token</span><span class="ruby-operator">|</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">token_stream</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">token</span> }

  <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">meth</span>
  <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">remove_private</span>
  <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">normalize</span>
  <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comment</span>
  <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">meth</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Creates an <a href="../../Method.html"><code>RDoc::Method</code></a> on <code>container</code> from <code>comment</code> if there is a Signature section in the comment</p>
        </div>


      </div>

      <div id="method-i-prepare_comments" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-prepare_comments" title="Link to this method">
                <span class="method-name">prepare_comments</span>
                <span class="method-args">(comments)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="prepare_comments-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prepare_comments</span>(<span class="ruby-identifier">comments</span>)
  <span class="ruby-identifier">current</span> = []
  <span class="ruby-identifier">consecutive_comments</span> = [<span class="ruby-identifier">current</span>]
  <span class="ruby-ivar">@modifier_comments</span> = {}
  <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Prism</span><span class="ruby-operator">::</span><span class="ruby-constant">EmbDocComment</span>
      <span class="ruby-identifier">consecutive_comments</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">comment</span>] <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">current</span> = [])
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line_slice</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\S/</span>)
      <span class="ruby-ivar">@modifier_comments</span>[<span class="ruby-identifier">comment</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>] = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">comment</span>.<span class="ruby-identifier">slice</span>, <span class="ruby-ivar">@top_level</span>, <span class="ruby-value">:ruby</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_line</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>
      <span class="ruby-identifier">current</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">comment</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">consecutive_comments</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">current</span> = [<span class="ruby-identifier">comment</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">consecutive_comments</span>.<span class="ruby-identifier">reject!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:empty?</span>)

  <span class="ruby-comment"># Example: line_no = 5, start_line = 2, comment_text = &quot;# comment_start_line\n# comment\n&quot;</span>
  <span class="ruby-comment"># 1| class A</span>
  <span class="ruby-comment"># 2|   # comment_start_line</span>
  <span class="ruby-comment"># 3|   # comment</span>
  <span class="ruby-comment"># 4|</span>
  <span class="ruby-comment"># 5|   def f; end # comment linked to this line</span>
  <span class="ruby-comment"># 6| end</span>
  <span class="ruby-ivar">@unprocessed_comments</span> = <span class="ruby-identifier">consecutive_comments</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comments</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">start_line</span> = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>
    <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_line</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_column</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
    <span class="ruby-identifier">texts</span> = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">c</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Prism</span><span class="ruby-operator">::</span><span class="ruby-constant">EmbDocComment</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">slice</span>.<span class="ruby-identifier">lines</span>[<span class="ruby-value">1</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">join</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">slice</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">text</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">change_encoding</span>(<span class="ruby-identifier">texts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>), <span class="ruby-ivar">@encoding</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@encoding</span>
    <span class="ruby-identifier">line_no</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">while</span> <span class="ruby-ivar">@lines</span>[<span class="ruby-identifier">line_no</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]&amp;.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\A\s*$/</span>)
    <span class="ruby-identifier">comment</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">text</span>, <span class="ruby-ivar">@top_level</span>, <span class="ruby-value">:ruby</span>)
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">start_line</span>
    [<span class="ruby-identifier">line_no</span>, <span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">comment</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># The first comment is special. It defines markup for the rest of the comments.</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">first_comment_start_line</span>, <span class="ruby-identifier">first_comment_text</span> = <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">first_comment_text</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@lines</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">first_comment_start_line</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\A\s*$/</span>) }
    <span class="ruby-identifier">comment</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">first_comment_text</span>.<span class="ruby-identifier">text</span>, <span class="ruby-ivar">@top_level</span>, <span class="ruby-value">:ruby</span>)
    <span class="ruby-identifier">handle_consecutive_comment_directive</span>(<span class="ruby-ivar">@container</span>, <span class="ruby-identifier">comment</span>)
    <span class="ruby-ivar">@markup</span> = <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">format</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">comment</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">format</span> = <span class="ruby-ivar">@markup</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Prepares comments for processing. Comments are grouped into consecutive. Consecutive comment is linked to the next non-blank line.</p>

<p>Example:</p>

<pre>01| class A # modifier comment 1
02|   def foo; end # modifier comment 2
03|
04|   # consecutive comment 1 start_line: 4
05|   # consecutive comment 1 linked to line: 7
06|
07|   # consecutive comment 2 start_line: 7
08|   # consecutive comment 2 linked to line: 10
09|
10|   def bar; end # consecutive comment 2 linked to this line
11| end</pre>
        </div>


      </div>

      <div id="method-i-process_comments_until" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-process_comments_until" title="Link to this method">
                <span class="method-name">process_comments_until</span>
                <span class="method-args">(line_no_until)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="process_comments_until-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 349</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_comments_until</span>(<span class="ruby-identifier">line_no_until</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">first</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">line_no_until</span>
    <span class="ruby-identifier">line_no</span>, <span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">rdoc_comment</span> = <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-identifier">handle_standalone_consecutive_comment_directive</span>(<span class="ruby-identifier">rdoc_comment</span>, <span class="ruby-identifier">line_no</span>, <span class="ruby-identifier">start_line</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Processes consecutive comments that were not linked to any documentable code until the given line number</p>
        </div>


      </div>

      <div id="method-i-resolve_constant_path" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-resolve_constant_path" title="Link to this method">
                <span class="method-name">resolve_constant_path</span>
                <span class="method-args">(constant_path)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="resolve_constant_path-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 603</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">resolve_constant_path</span>(<span class="ruby-identifier">constant_path</span>)
  <span class="ruby-identifier">owner_name</span>, <span class="ruby-identifier">path</span> = <span class="ruby-identifier">constant_path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;::&#39;</span>, <span class="ruby-value">2</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">constant_path</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">owner_name</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment"># ::Foo, ::Foo::Bar</span>
  <span class="ruby-identifier">mod</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@module_nesting</span>.<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">nesting</span>, <span class="ruby-identifier">singleton</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">singleton</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">nesting</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">owner_name</span>)
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">mod</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@top_level</span>.<span class="ruby-identifier">find_module_named</span>(<span class="ruby-identifier">owner_name</span>)
  [<span class="ruby-identifier">mod</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-identifier">path</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;::&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Resolves constant path to a full path by searching module nesting</p>
        </div>


      </div>

      <div id="method-i-scan" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-scan" title="Link to this method">
                <span class="method-name">scan</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="scan-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan</span>
  <span class="ruby-ivar">@tokens</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">RipperStateLex</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-ivar">@content</span>)
  <span class="ruby-ivar">@lines</span> = <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">lines</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">Prism</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-ivar">@content</span>)
  <span class="ruby-ivar">@program_node</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">value</span>
  <span class="ruby-ivar">@line_nodes</span> = {}
  <span class="ruby-identifier">prepare_line_nodes</span>(<span class="ruby-ivar">@program_node</span>)
  <span class="ruby-identifier">prepare_comments</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@top_level</span>.<span class="ruby-identifier">done_documenting</span>

  <span class="ruby-ivar">@first_non_meta_comment</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">_line_no</span>, <span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">rdoc_comment</span> = <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">first</span>)
    <span class="ruby-ivar">@first_non_meta_comment</span> = <span class="ruby-identifier">rdoc_comment</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_line</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@program_node</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@program_node</span>.<span class="ruby-identifier">accept</span>(<span class="ruby-constant">RDocVisitor</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-ivar">@top_level</span>, <span class="ruby-ivar">@store</span>))
  <span class="ruby-identifier">process_comments_until</span>(<span class="ruby-ivar">@lines</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Scans this Ruby file for Ruby constructs</p>
        </div>


      </div>

      <div id="method-i-skip_comments_until" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-skip_comments_until" title="Link to this method">
                <span class="method-name">skip_comments_until</span>
                <span class="method-args">(line_no_until)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="skip_comments_until-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">skip_comments_until</span>(<span class="ruby-identifier">line_no_until</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">first</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">line_no_until</span>
    <span class="ruby-ivar">@unprocessed_comments</span>.<span class="ruby-identifier">shift</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Skips all undocumentable consecutive comments until the given line number. Undocumentable comments are comments written inside ‘def` or inside undocumentable class/module</p>
        </div>


      </div>

      <div id="method-i-visible_tokens_from_location" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-visible_tokens_from_location" title="Link to this method">
                <span class="method-name">visible_tokens_from_location</span>
                <span class="method-args">(location)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="visible_tokens_from_location-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 389</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">visible_tokens_from_location</span>(<span class="ruby-identifier">location</span>)
  <span class="ruby-identifier">position_comment</span> = <span class="ruby-identifier">file_line_comment_token</span>(<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>)
  <span class="ruby-identifier">newline_token</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">RipperStateLex</span><span class="ruby-operator">::</span><span class="ruby-constant">Token</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">:on_nl</span>, <span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-identifier">indent_token</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">RipperStateLex</span><span class="ruby-operator">::</span><span class="ruby-constant">Token</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>, <span class="ruby-value">0</span>, <span class="ruby-value">:on_sp</span>, <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_character_column</span>)
  <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">slice_tokens</span>(
    [<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_line</span>, <span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_character_column</span>],
    [<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_line</span>, <span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_character_column</span>]
  )
  [<span class="ruby-identifier">position_comment</span>, <span class="ruby-identifier">newline_token</span>, <span class="ruby-identifier">indent_token</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">tokens</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Returns tokens from the given location</p>
        </div>


      </div>

      <div id="method-i-with_container" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-with_container" title="Link to this method">
                <span class="method-name">with_container</span>
                <span class="method-args">(container, singleton: false) { |container| ... }</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="with_container-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_container</span>(<span class="ruby-identifier">container</span>, <span class="ruby-value">singleton:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">old_container</span> = <span class="ruby-ivar">@container</span>
  <span class="ruby-identifier">old_visibility</span> = <span class="ruby-ivar">@visibility</span>
  <span class="ruby-identifier">old_singleton</span> = <span class="ruby-ivar">@singleton</span>
  <span class="ruby-identifier">old_in_proc_block</span> = <span class="ruby-ivar">@in_proc_block</span>
  <span class="ruby-ivar">@visibility</span> = <span class="ruby-value">:public</span>
  <span class="ruby-ivar">@container</span> = <span class="ruby-identifier">container</span>
  <span class="ruby-ivar">@singleton</span> = <span class="ruby-identifier">singleton</span>
  <span class="ruby-ivar">@in_proc_block</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">singleton</span>
    <span class="ruby-comment"># Need to update module parent chain to emulate Module.nesting.</span>
    <span class="ruby-comment"># This mechanism is inaccurate and needs to be fixed.</span>
    <span class="ruby-identifier">container</span>.<span class="ruby-identifier">parent</span> = <span class="ruby-identifier">old_container</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@module_nesting</span>.<span class="ruby-identifier">push</span>([<span class="ruby-identifier">container</span>, <span class="ruby-identifier">singleton</span>])
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">container</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@container</span> = <span class="ruby-identifier">old_container</span>
  <span class="ruby-ivar">@visibility</span> = <span class="ruby-identifier">old_visibility</span>
  <span class="ruby-ivar">@singleton</span> = <span class="ruby-identifier">old_singleton</span>
  <span class="ruby-ivar">@in_proc_block</span> = <span class="ruby-identifier">old_in_proc_block</span>
  <span class="ruby-ivar">@module_nesting</span>.<span class="ruby-identifier">pop</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Dive into another container</p>
        </div>


      </div>

      <div id="method-i-with_in_proc_block" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-with_in_proc_block" title="Link to this method">
                <span class="method-name">with_in_proc_block</span>
                <span class="method-args">() { || ... }</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="with_in_proc_block-source">
            <pre><span class="ruby-comment"># File lib/rdoc/parser/prism_ruby.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_in_proc_block</span>
  <span class="ruby-ivar">@in_proc_block</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">yield</span>
  <span class="ruby-ivar">@in_proc_block</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Suppress ‘extend` and `include` within block because they might be a metaprogramming block example: `Module.new { include M }` `M.module_eval { include N }`</p>
        </div>


      </div>

    </section>

  </section>
</main>

