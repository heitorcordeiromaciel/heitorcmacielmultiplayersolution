<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>class PTY - Documentation for Ruby 3.4</title>

  <meta name="keywords" content="ruby,class,PTY">

    <meta name="description" content="class PTY: Creates and manages pseudo terminals (PTYs). en.">


<link rel="canonical" href="https://docs.ruby-lang.org/en/3.4/PTY.html">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>



  <ul class="link-list" role="directory">
              <li>      <a href="#class-PTY-label-Example">Example</a>
          <li>      <a href="#class-PTY-label-License">License</a>

  </ul>
</div>

  
  <div id="parent-class-section" class="nav-section">
  <h3>Ancestors</h3>
  <ul><li><a href="Object.html">Object</a><ul><li><a href="BasicObject.html">BasicObject</a></li></ul></li></ul>
</div>

  
  
  
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-c-check">check</a></li>
      <li ><a href="#method-c-getpty">getpty</a></li>
      <li ><a href="#method-c-open">open</a></li>
      <li ><a href="#method-c-spawn">spawn</a></li>
    </ul>
  </div>





  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.14.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="class-PTY">
  
  

  <h1 id="class-PTY" class="anchor-link class">
    class PTY
  </h1>

  <section class="description">
    
<p>Creates and manages pseudo terminals (PTYs).  See also <a href="https://en.wikipedia.org/wiki/Pseudo_terminal">en.wikipedia.org/wiki/Pseudo_terminal</a></p>

<p><a href="PTY.html"><code>PTY</code></a> allows you to allocate new terminals using <a href="PTY.html#method-c-open"><code>::open</code></a> or <a href="PTY.html#method-c-spawn"><code>::spawn</code></a> a new terminal with a specific command.</p>

<h2 id="class-PTY-label-Example">Example<span><a href="#class-PTY-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>In this example we will change the buffering type in the <code>factor</code> command, assuming that factor uses stdio for stdout buffering.</p>

<p>If <a href="IO.html#method-c-pipe"><code>IO.pipe</code></a> is used instead of <a href="PTY.html#method-c-open"><code>PTY.open</code></a>, this code deadlocks because factor’s stdout is fully buffered.</p>

<pre class="ruby"><span class="ruby-comment"># start by requiring the standard library PTY</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;pty&#39;</span>

<span class="ruby-identifier">master</span>, <span class="ruby-identifier">slave</span> = <span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span>
<span class="ruby-identifier">read</span>, <span class="ruby-identifier">write</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
<span class="ruby-identifier">pid</span> = <span class="ruby-identifier">spawn</span>(<span class="ruby-string">&quot;factor&quot;</span>, <span class="ruby-value">:in</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">read</span>, <span class="ruby-value">:out</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">slave</span>)
<span class="ruby-identifier">read</span>.<span class="ruby-identifier">close</span>     <span class="ruby-comment"># we dont need the read</span>
<span class="ruby-identifier">slave</span>.<span class="ruby-identifier">close</span>    <span class="ruby-comment"># or the slave</span>

<span class="ruby-comment"># pipe &quot;42&quot; to the factor command</span>
<span class="ruby-identifier">write</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;42&quot;</span>
<span class="ruby-comment"># output the response from factor</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">master</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment">#=&gt; &quot;42: 2 3 7\n&quot;</span>

<span class="ruby-comment"># pipe &quot;144&quot; to factor and print out the response</span>
<span class="ruby-identifier">write</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;144&quot;</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">master</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment">#=&gt; &quot;144: 2 2 2 2 3 3\n&quot;</span>
<span class="ruby-identifier">write</span>.<span class="ruby-identifier">close</span> <span class="ruby-comment"># close the pipe</span>

<span class="ruby-comment"># The result of read operation when pty slave is closed is platform</span>
<span class="ruby-comment"># dependent.</span>
<span class="ruby-identifier">ret</span> = <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">master</span>.<span class="ruby-identifier">gets</span>     <span class="ruby-comment"># FreeBSD returns nil.</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EIO</span> <span class="ruby-comment"># GNU/Linux raises EIO.</span>
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">ret</span> <span class="ruby-comment">#=&gt; nil</span>
</pre>

<h2 id="class-PTY-label-License">License<span><a href="#class-PTY-label-License">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>© Copyright 1998 by Akinori Ito.</p>

<p>This software may be redistributed freely for this purpose, in full or in part, provided that this entire copyright notice is included on any copies of this software and applications and derivations thereof.</p>

<p>This software is provided on an “as is” basis, without warranty of any kind, either expressed or implied, as to any matter including, but not limited to warranty of fitness of purpose, or merchantability, or results obtained from use of this software.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">





     <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-check" class="method-detail anchor-link ">
        <div class="method-header">
              <div class="method-heading">
                <a href="#method-c-check" title="Link to this method">
                  <span class="method-callseq">
                    check(pid, raise = false) &rarr; Process::Status or nil
                  </span>
                </a>
              </div>
              <div class="method-heading">
                <a href="#method-c-check" title="Link to this method">
                  <span class="method-callseq">
                    check(pid, true)          &rarr; nil or raises PTY::ChildExited
                  </span>
                </a>
              </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="check-source">
            <pre>static VALUE
pty_check(int argc, VALUE *argv, VALUE self)
{
    VALUE pid, exc;
    rb_pid_t cpid;
    int status;
    const int flag =
#ifdef WNOHANG
        WNOHANG|
#endif
#ifdef WUNTRACED
        WUNTRACED|
#endif
        0;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;pid, &amp;exc);
    cpid = rb_waitpid(NUM2PIDT(pid), &amp;status, flag);
    if (cpid == -1 || cpid == 0) return Qnil;

    if (!RTEST(exc)) return rb_last_status_get();
    raise_from_check(cpid, status);

    UNREACHABLE_RETURN(Qnil);
}</pre>
          </div>
          <p>Checks the status of the child process specified by <code>pid</code>. Returns <code>nil</code> if the process is still alive.</p>

<p>If the process is not alive, and <code>raise</code> was true, a <a href="PTY/ChildExited.html"><code>PTY::ChildExited</code></a> exception will be raised. Otherwise it will return a <a href="Process/Status.html"><code>Process::Status</code></a> instance.</p>
<dl class="rdoc-list note-list"><dt><code>pid</code></dt>
<dd>
<p>The process id of the process to check</p>
</dd><dt><code>raise</code></dt>
<dd>
<p>If <code>true</code> and the process identified by <code>pid</code> is no longer alive a <a href="PTY/ChildExited.html"><code>PTY::ChildExited</code></a> is raised.</p>
</dd></dl>
        </div>


      </div>

      <div id="method-c-getpty" class="method-detail anchor-link method-alias">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-getpty" title="Link to this method">
                <span class="method-name">getpty</span>
              </a>
            </div>
        </div>




        <div class="aliases">
          Alias for: <a href="PTY.html#method-c-spawn">spawn</a>
        </div>
      </div>

      <div id="method-c-open" class="method-detail anchor-link ">
        <div class="method-header">
              <div class="method-heading">
                <a href="#method-c-open" title="Link to this method">
                  <span class="method-callseq">
                    open &rarr; [master_io, slave_file]
                  </span>
                </a>
              </div>
              <div class="method-heading">
                <a href="#method-c-open" title="Link to this method">
                  <span class="method-callseq">
                    open {|(master_io, slave_file)| ... } &rarr; block value
                  </span>
                </a>
              </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="open-source">
            <pre>static VALUE
pty_open(VALUE klass)
{
    int master_fd, slave_fd;
    char slavename[DEVICELEN];

    getDevice(&amp;master_fd, &amp;slave_fd, slavename, 1);

    VALUE master_path = rb_obj_freeze(rb_sprintf(&quot;masterpty:%s&quot;, slavename));
    VALUE master_io = rb_io_open_descriptor(rb_cIO, master_fd, FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX, master_path, RUBY_IO_TIMEOUT_DEFAULT, NULL);

    VALUE slave_path = rb_obj_freeze(rb_str_new_cstr(slavename));
    VALUE slave_file = rb_io_open_descriptor(rb_cFile, slave_fd, FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX | FMODE_TTY, slave_path, RUBY_IO_TIMEOUT_DEFAULT, NULL);

    VALUE assoc = rb_assoc_new(master_io, slave_file);

    if (rb_block_given_p()) {
        return rb_ensure(rb_yield, assoc, pty_close_pty, assoc);
    }

    return assoc;
}</pre>
          </div>
          <p>Allocates a pty (pseudo-terminal).</p>

<p>In the block form, yields an array of two elements (<code>master_io, slave_file</code>) and the value of the block is returned from <code>open</code>.</p>

<p>The <a href="IO.html"><code>IO</code></a> and <a href="File.html"><code>File</code></a> are both closed after the block completes if they haven’t been already closed.</p>

<pre class="ruby"><span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">master</span>, <span class="ruby-identifier">slave</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">master</span>      <span class="ruby-comment">#=&gt; #&lt;IO:masterpty:/dev/pts/1&gt;</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">slave</span>      <span class="ruby-comment">#=&gt; #&lt;File:/dev/pts/1&gt;</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">slave</span>.<span class="ruby-identifier">path</span> <span class="ruby-comment">#=&gt; &quot;/dev/pts/1&quot;</span>
}
</pre>

<p>In the non-block form, returns a two element array, <code>[master_io, slave_file]</code>.</p>

<pre class="ruby"><span class="ruby-identifier">master</span>, <span class="ruby-identifier">slave</span> = <span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span>
<span class="ruby-comment"># do something with master for IO, or the slave file</span>
</pre>

<p>The arguments in both forms are:</p>
<dl class="rdoc-list note-list"><dt><code>master_io</code></dt>
<dd>
<p>the master of the pty, as an <a href="IO.html"><code>IO</code></a>.</p>
</dd><dt><code>slave_file</code></dt>
<dd>
<p>the slave of the pty, as a <a href="File.html"><code>File</code></a>.  The path to the terminal device is available via <code>slave_file.path</code></p>
</dd></dl>

<p><a href="IO.html#method-i-raw-21"><code>IO#raw!</code></a> is usable to disable newline conversions:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;io/console&#39;</span>
<span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">raw!</span>
  <span class="ruby-comment"># ...</span>
}
</pre>
        </div>


      </div>

      <div id="method-c-spawn" class="method-detail anchor-link ">
        <div class="method-header">
              <div class="method-heading">
                <a href="#method-c-spawn" title="Link to this method">
                  <span class="method-callseq">
                    spawn([env,] command_line)  { |r, w, pid| ... }
                  </span>
                </a>
              </div>
              <div class="method-heading">
                <a href="#method-c-spawn" title="Link to this method">
                  <span class="method-callseq">
                    spawn([env,] command_line)  &rarr; [r, w, pid]
                  </span>
                </a>
              </div>
              <div class="method-heading">
                <a href="#method-c-spawn" title="Link to this method">
                  <span class="method-callseq">
                    spawn([env,] command, arguments, ...)  { |r, w, pid| ... }
                  </span>
                </a>
              </div>
              <div class="method-heading">
                <a href="#method-c-spawn" title="Link to this method">
                  <span class="method-callseq">
                    spawn([env,] command, arguments, ...)  &rarr; [r, w, pid]
                  </span>
                </a>
              </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="spawn-source">
            <pre>static VALUE
pty_getpty(int argc, VALUE *argv, VALUE self)
{
    VALUE res;
    struct pty_info info;
    char SlaveName[DEVICELEN];

    establishShell(argc, argv, &amp;info, SlaveName);

    VALUE pty_path = rb_obj_freeze(rb_str_new_cstr(SlaveName));
    VALUE rport = rb_io_open_descriptor(
        rb_cFile, info.fd, FMODE_READABLE, pty_path, RUBY_IO_TIMEOUT_DEFAULT, NULL
    );

    int wpty_fd = rb_cloexec_dup(info.fd);
    if (wpty_fd == -1) {
        rb_sys_fail(&quot;dup()&quot;);
    }
    VALUE wport = rb_io_open_descriptor(
        rb_cFile, wpty_fd, FMODE_WRITABLE | FMODE_TRUNC | FMODE_CREATE | FMODE_SYNC,
        pty_path, RUBY_IO_TIMEOUT_DEFAULT, NULL
    );

    res = rb_ary_new2(3);
    rb_ary_store(res, 0, rport);
    rb_ary_store(res, 1, wport);
    rb_ary_store(res,2,PIDT2NUM(info.child_pid));

    if (rb_block_given_p()) {
        rb_ensure(rb_yield, res, pty_detach_process, (VALUE)&amp;info);
        return Qnil;
    }
    return res;
}</pre>
          </div>
          <p>Spawns the specified command on a newly allocated pty. You can also use the alias <a href="PTY.html#method-c-getpty"><code>::getpty</code></a>.</p>

<p>The command’s controlling tty is set to the slave device of the pty and its standard input/output/error is redirected to the slave device.</p>

<p><code>env</code> is an optional hash that provides additional environment variables to the spawned pty.</p>

<pre class="ruby"><span class="ruby-comment"># sets FOO to &quot;bar&quot;</span>
<span class="ruby-constant">PTY</span>.<span class="ruby-identifier">spawn</span>({<span class="ruby-string">&quot;FOO&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;bar&quot;</span>}, <span class="ruby-string">&quot;printenv&quot;</span>, <span class="ruby-string">&quot;FOO&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span>, <span class="ruby-identifier">w</span>, <span class="ruby-identifier">pid</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">read</span> <span class="ruby-comment">#=&gt; &quot;bar\r\n&quot;</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">close</span>; <span class="ruby-identifier">w</span>.<span class="ruby-identifier">close</span>; <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-comment"># unsets FOO</span>
<span class="ruby-constant">PTY</span>.<span class="ruby-identifier">spawn</span>({<span class="ruby-string">&quot;FOO&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>}, <span class="ruby-string">&quot;printenv&quot;</span>, <span class="ruby-string">&quot;FOO&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span>, <span class="ruby-identifier">w</span>, <span class="ruby-identifier">pid</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">read</span> <span class="ruby-comment">#=&gt; &quot;&quot;</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">close</span>; <span class="ruby-identifier">w</span>.<span class="ruby-identifier">close</span>; <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span>)
<span class="ruby-keyword">end</span>
</pre>

<p><code>command</code> and <code>command_line</code> are the full commands to run, given a <a href="String.html"><code>String</code></a>. Any additional <code>arguments</code> will be passed to the command.</p>

<h3 id="method-c-spawn-label-Return+values">Return values<span><a href="#method-c-spawn-label-Return+values">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In the non-block form this returns an array of size three, <code>[r, w, pid]</code>.</p>

<p>In the block form these same values will be yielded to the block:</p>
<dl class="rdoc-list note-list"><dt><code>r</code></dt>
<dd>
<p>A readable <a href="IO.html"><code>IO</code></a> that contains the command’s standard output and standard error</p>
</dd><dt><code>w</code></dt>
<dd>
<p>A writable <a href="IO.html"><code>IO</code></a> that is the command’s standard input</p>
</dd><dt><code>pid</code></dt>
<dd>
<p>The process identifier for the command.</p>
</dd></dl>

<h3 id="method-c-spawn-label-Clean+up">Clean up<span><a href="#method-c-spawn-label-Clean+up">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>This method does not clean up like closing IOs or waiting for child process, except that the process is detached in the block form to prevent it from becoming a zombie (see <a href="Process.html#method-c-detach"><code>Process.detach</code></a>).  Any other cleanup is the responsibility of the caller.  If waiting for <code>pid</code>, be sure to close both <code>r</code> and <code>w</code> before doing so; doing it in the reverse order may cause deadlock on some OSes.</p>
        </div>

        <div class="aliases">
          Also aliased as: <a href="PTY.html#method-c-getpty">getpty</a>
        </div>

      </div>

    </section>

  </section>
</main>

